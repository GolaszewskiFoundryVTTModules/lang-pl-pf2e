Die rolls:
([0-9]*)(d)([0-9]+)
$1k$3

Die rolls not in formulas:
(?<!\[[^\]]*)([0-9]*)(d)([0-9]+)(?![^\[]*\])
$1k$3